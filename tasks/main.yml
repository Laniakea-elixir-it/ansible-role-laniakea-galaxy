---

- include_vars: vars-RedHat.yml
  when: ansible_os_family == 'RedHat'

- name: Install dependencies 
  import_tasks: pre-tasks.yml

- name: Include postgresql role
  include_role:
    name: galaxyproject.postgresql

- name: Include natefoo role 
  import_tasks: postgresql_objects.yml

- name: Include geerlingguy role 
  include_role:
    name: geerlingguy.pip
  vars:
    pip_package: python-pip
  when: ansible_os_family == "RedHat" 

- name: Include geerlingguy role [ubuntu]
  include_role:
    name: geerlingguy.pip
  vars:
    pip_package: python3-pip
  when: ansible_os_family == "Debian"

- name: '[Ubuntu] Include galaxy role'
  import_tasks: install_galaxy_Debian.yml
  when: ansible_os_family == "Debian"

- name: '[EL] Include galaxy role'
  import_tasks: install_galaxy_RedHat.yml
  when: ansible_os_family == "RedHat"

- name: Include miniconda role run by galaxy user
  import_tasks: miniconda.yml
  become: yes
  become_user: galaxy

- name: Include systemd role
  import_tasks: systemd.yml

- name: Include nginx role
  import_tasks: nginx.yml

- name: Include proftpd role
  import_tasks: proftpd.yml
  become: yes
  become_user: root

- name: set default laniakea job conf 
  import_tasks: job_conf.yml
  become: yes 
  become_user: galaxy
  when: uwsgi_mode == "zerg"

- name: create admin user
  include: admin_user.yml
